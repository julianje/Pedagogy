---
title: "Pedagogy model"
output:
  html_document:
    theme: spacelab
    toc: yes
  pdf_document:
    toc: yes
---

```{r Load data and packages, echo=FALSE}
library(plyr, quietly=T, warn.conflicts=F)
library(dplyr, quietly=T, warn.conflicts=F)
library(ggplot2, quietly=T, warn.conflicts=F)
library(ggvis, quietly=T, warn.conflicts=F)
library(tidyr, quietly=T, warn.conflicts=F)
library(knitr, quietly=T, warn.conflicts=F)
library(boot, quietly=T, warn.conflicts=F)
setwd("~/Documents/Projects/Models/Pedagogy/Pedagogy/Data/")
dataA <- read.csv("ModelPredictions_FullJoint.csv") %>% tbl_df %>% mutate(Model=paste(LearnC,LearnR,TeachC,TeachR,DiscoverC,DiscoverR))
dataB <- read.csv("ModelPredictions_UncertaintySearch.csv") %>% tbl_df %>% mutate(Model=paste(LearnC,LearnR,TeachC,TeachR,DiscoverC,DiscoverR))
data<-rbind(dataA,dataB)
levels(data$Condition)=c("1: Equal\nCosts","4: Inverted\nRewards","3: Matched\nRewards","2: Unequal\nCosts")
data$Condition<-as.character(data$Condition)
data$ExploreProb<-factor(data$ExploreProb)
levels(data$ExploreProb)=c(".25 Exploration",".5 Exploration",".75 Exploration","Exploration\ncertainty")
levels(data$TeacherReward)=c("Constant\nteacher reward","Variable\nteacher reward")
levels(data$Decision)=c("Either","Red toy","Yellow toy")
Summarydata<-plyr::ddply(data,c("ExploreProb","TeacherReward","Condition","Model"),function(x){return(data.frame(table(x$Decision)))}) %>% tbl_df %>% dplyr::rename(Decision=Var1)
# Get total by subselecting one set
Total<-Summarydata %>% filter(ExploreProb==".5 Exploration",
                       TeacherReward=="Constant\nteacher reward",
                       Condition=="1: Equal\nCosts",
                       Model=="0 0 0 0 1 1") %>% select(Freq) %>% sum
Summarydata <- Summarydata %>% mutate(Percentage=Freq*100/Total) %>% select(-Freq)
# Create alternate data frame where either gets split into the other two categories (as children will choose at random).
ConcreteChoices <- Summarydata %>% filter(Decision %in% c("Yellow toy","Red toy"))
NoPref <- Summarydata %>% filter(Decision %in% c("Either")) %>% mutate(PercAdd=Percentage/2) %>% select(-Percentage,-Decision)
Simpledata <- full_join(ConcreteChoices,NoPref,by=c("ExploreProb","TeacherReward","Condition","Model")) %>% mutate(Perc=Percentage+PercAdd) %>% select(-Percentage,-PercAdd)
rm(ConcreteChoices,NoPref,data,dataA,dataB)
```

# Full model predictions

Model predictions as a function of exploration certainty. Values 0.25, 0.5, 0.75, and 1 indicate the probability that the learner will explore the untaught toy.


```{r MegaSummaryb, echo=FALSE, fig.width = 15, fig.height = 5}
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")

Tempdat<-Simpledata %>% filter(Model %in% ModelSpace)
Tempdat$Model<-factor(Tempdat$Model)
levels(Tempdat$Model)=c("Novel\nonly","Rewards\nonly","Costs\nonly","Learned\nonly","Full\nmodel")
Tempdat$Decision<-as.character(Tempdat$Decision)
Tempdat %>% ggplot(aes(x=Condition,y=Perc,fill=Decision))+geom_bar(stat="identity")+facet_grid(Model~ExploreProb)+theme_bw()+scale_fill_manual(values=c("#C7363D","#EBE549"))+scale_y_continuous("Percentage\nof choices")
```

# Model fits

In each plot, entry i,j (row i, column j) shows the likelihood of model i generating the empirical data divided by the likelihood of model j generating the empirical data. Thus, values above 1 (green color-coded) indicate that the row model has a higher likelihood of generating the empirical data than the column model. Conversely, values below 1 (red color-coded) indicate that the row model has a lower likelihood of generating the empirical data than the column model. Values equal to 1 (blue color-coded) indicate both models are equally likely to have generated the data. For each section, alpha indicates the probability of participants getting distracted and responding at chance.

As the plots above show, the full model outperforms all other alternative models for a wide range of noise parameters.

## Alpha = 0.01

```{r GetLikA, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.01
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T1<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.01)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.05

```{r GetLikB, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.05
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T2<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.05)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.1

```{r GetLikC, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.1
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T3<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.1)

DetailedProbs <- Probs

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.2

```{r GetLik2, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.2
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T4<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.2)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.3

```{r GetLik3, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.3
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T5<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.3)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.4

```{r GetLik4, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.4
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T6<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.4)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

## Alpha = 0.5

```{r GetLi8, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseParam=0.5
ModelSpace=c("1 1 0 0 1 1","1 0 0 0 1 0","0 1 0 0 0 1","1 1 0 0 0 0","0 0 0 0 1 1")
Probs <- Simpledata %>% filter(TeacherReward=="Constant\nteacher reward",ExploreProb==".5 Exploration",Decision=="Red toy") %>% mutate(Prob=Perc/100) %>% select(-TeacherReward,-ExploreProb,-Decision,-Perc)
# Load experiment results
Empirical<-read.csv("EmpiricalData.csv") %>% tbl_df
levels(Empirical$Condition)=c("1: Equal\nCosts","2: Unequal\nCosts","3: Matched\nRewards","4: Inverted\nRewards")
Empirical$Condition<-as.character(Empirical$Condition)
Probs$Condition<-as.character(Probs$Condition)
Probs <- full_join(Probs,Empirical,by="Condition") %>%
  dplyr::mutate(NoiseProb=(1-NoiseParam)*Prob+NoiseParam/2)
Probs<-plyr::ddply(Probs,c("Condition","Model","Prob","RedToy","SampleSize","NoiseProb"),function(x){binom.test(x$RedToy,x$SampleSize,x$NoiseProb)$p.value}) %>% dplyr::rename(Likelihood=V1) %>% tbl_df
# Now get the likelihood of each model producing the whole dataset.
FinalProbs<-Probs %>% filter(Model %in% ModelSpace) %>% dplyr::group_by(Model) %>% dplyr::summarise(Likelihood=prod(Likelihood))

# Costs only first
LikelihoodRatios=data.frame(
  ModelA=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),each=5),
  ModelB=rep(c("Costs only","Rewards only","Learned toy","Novel toy","Full model"),5),
  LR=c(
    FinalProbs[3,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[3,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[2,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[4,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[1,]$Likelihood/FinalProbs[5,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[3,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[2,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[4,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[1,]$Likelihood,
FinalProbs[5,]$Likelihood/FinalProbs[5,]$Likelihood
)
  ) %>% mutate(Performance=ifelse(LR>1,"Better",ifelse(LR<1,"Worse","Equal"))) %>% tbl_df
# Very hacky but deadline happening. These are values for noise = 0.1
#LikelihoodRatios$Short=c("1.00e+00","2.48e-04","6.01e+16","2.99e+01","9.99e-09","4.03e+03","1.00e+00","2.42e+20","1.21e+05","4.02e-05","1.67e-17","4.13e-21","1.00e+00","4.98e-16","1.66e-25","3.34e-02","8.29e-06","2.01e+15","1.00e+00","3.34e-10","1.00e+08","2.49e+04","6.01e+24","3.00e+09","1.00e+00")

LikelihoodRatios$ModelA=factor(LikelihoodRatios$ModelA,levels(LikelihoodRatios$ModelA)[c(2,4,3,5,1)])
LikelihoodRatios$ModelB=factor(LikelihoodRatios$ModelB,levels(LikelihoodRatios$ModelB)[c(1,5,3,4,2)])

T7<-LikelihoodRatios %>% filter(ModelA=="Full model") %>% mutate(Noise=0.5)

LikelihoodRatios %>% ggplot(aes(x=ModelB,y=ModelA,fill=Performance,label=format(LR)))+geom_tile()+geom_text()+theme_bw()+scale_fill_manual(values=c("#3AB551","#35A7F2","#B53A40"))+scale_y_discrete("Nominator")+scale_x_discrete("Denominator")
```

# Likelihood per condition

Likelihood of each model generating the data of each individual condition when exploration uncertainty = 0.5 and noise = 0.1

```{r DetailedProbs, echo=FALSE, fig.width = 15}
# Get probability of choosing red toy.
DetailedProbs$Model<-factor(DetailedProbs$Model)
levels(DetailedProbs$Model)=c("Untaught toy","Rewards only","Costs only","Taught toy","Full model")
DetailedProbs %>% ggplot(aes(x=Condition,y=Model,fill=Likelihood,label=Likelihood))+geom_tile()+geom_text()+theme_bw()
```

# Noise summary

log(L(Data|FullModel)/L(Data|AlternativeModel)) as a function of different noise parameters. All values are above 0 (meaning that the likelihood ratio is greater than 1), showing that the full model explains the data better than all alternative models, independent of the noise parameter.

```{r NoiseSum, echo=FALSE, fig.width = 10}
# Get probability of choosing red toy.
NoiseSum<-rbind(T1,T2,T3,T4,T5,T6,T7)
NoiseSum %>% filter(ModelB!="Full model") %>% ggplot(aes(x=ModelB,y=log(LR),color=Noise,group=Noise))+geom_point(size=3)+theme_bw()+geom_line()+scale_x_discrete("Alternative model")+scale_y_continuous("Log-likelihood between full model\nand alternative models")
```

# Model details

## Novel toy only

Model reasoning only about learner's experience with the novel toy

```{r Plot_000011, echo=FALSE, fig.width = 10, fig.height = 5}
Summarydata %>% filter(TeacherReward=="Constant\nteacher reward") %>%
  filter(Model=="0 0 0 0 1 1") %>%
  ggplot(aes(x=Condition,y=Percentage,fill=Decision))+geom_bar(color="black",stat="identity")+facet_grid(ExploreProb~TeacherReward)+
  theme_bw()+scale_fill_manual(values=c("#00B554","#C7363D","#EBE549"))
```

## Learned toy only

Model reasoning only about learner's experience with taught toy

```{r Plot_110000, echo=FALSE, fig.width = 10, fig.height = 5}
Summarydata %>% filter(TeacherReward=="Constant\nteacher reward") %>%
  filter(Model=="1 1 0 0 0 0") %>%
  ggplot(aes(x=Condition,y=Percentage,fill=Decision))+geom_bar(color="black",stat="identity")+facet_grid(ExploreProb~TeacherReward)+
  theme_bw()+scale_fill_manual(values=c("#00B554","#C7363D","#EBE549"))
```

## Rewards only

Model only considering the learner's rewards with both toys

```{r Plot_010001, echo=FALSE, fig.width = 10, fig.height = 5}
Summarydata %>% filter(TeacherReward=="Constant\nteacher reward") %>%
  filter(Model=="0 1 0 0 0 1") %>%
  ggplot(aes(x=Condition,y=Percentage,fill=Decision))+geom_bar(color="black",stat="identity")+facet_grid(ExploreProb~TeacherReward)+
  theme_bw()+scale_fill_manual(values=c("#00B554","#C7363D","#EBE549"))
```

## Costs only

Model only considering the learner's costs with both toys

```{r Plot_100010, echo=FALSE, fig.width = 10, fig.height = 5}
Summarydata %>% filter(TeacherReward=="Constant\nteacher reward") %>%
  filter(Model=="1 0 0 0 1 0") %>%
  ggplot(aes(x=Condition,y=Percentage,fill=Decision))+geom_bar(color="black",stat="identity")+facet_grid(ExploreProb~TeacherReward)+
  theme_bw()+scale_fill_manual(values=c("#00B554","#C7363D","#EBE549"))
```

## Full model

Model reasoning about learner's experience with the taught and with the novel toy

```{r Plot_110011, echo=FALSE, fig.width = 10, fig.height = 5}
Summarydata %>%
  filter(Model=="1 1 0 0 1 1") %>%
  ggplot(aes(x=Condition,y=Percentage,fill=Decision))+geom_bar(color="black",stat="identity")+facet_grid(ExploreProb~TeacherReward)+
  theme_bw()+scale_fill_manual(values=c("#00B554","#C7363D","#EBE549"))
```
